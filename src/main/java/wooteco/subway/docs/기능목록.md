## 기능목록

### 지하철역/노선 관리 기능

- [x] 기존에 존재하는 지하철역 이름으로 등록을 시도하면 400을 반환하는 기능
- [x] 노선 생성 기능
- [x] 노선 목록 조회 기능
- [x] 노선 조회 기능
- [x] 노선 수정 기능
- [x] 노선 삭제 기능

### 2단계 프레임워크 적용

- [x] h2, schema 설정
- [x] Service Layer 구현
    - [x] StationService 구현
    - [x] LineService 구현

- [x] 스프링 JDBC를 적용
    - [x] Station Repository
        - [x] Save, Exist 기능 구현
        - [x] get 기능 구현
        - [x] delete 기능 구현
    - [x] Line Repository
        - [x] 이름이랑 색깔을 입력받아 Line 생성기능 구현
        - [x] Line이 존재하는지 확인하는 기능 구현
        - [x] 전체 Line 리스트 조회 기능 구현
        - [x] id를 통해 특정 Line 조회 기능 구현
        - [x] id를 통해 특정 Line 정보 수정 기능 구현
        - [x] id를 통해 특정 Line 삭제 기능 구현

## Refactoring TODO

- [x] 커스텀 예외를 만들어서, Advice에서 따로 처리하도록 수정
- [x] 모든 path가 동일하게 사용되는 부분의 컨트롤러를 `/lines`, `/stations` 로 매핑하기
- [x] `@Transaactional` 어노테이션의 위치를 수정
- [x] 들여쓰기 수정
- [x] 사용하지 않는 Dao 제거
- [x] `DTO <-> Domain Object` 변환 과정을 Service에서 수행하도록 수정
    - [x] LineController 수정
    - [x] StationController 수정
- [x] 클래스 구현 순서 수정
- [x] Excepetion 으로 뭉뚱 그려 처리하던 예외를 명시적인 예외로 수정
    - [x] LineRepo
    - [x] StationRepo
- [x] 실패하는 경우(예외가 발생하는 경우) 에 대한 테스트 코드 추가
    - [x] LineRepoTest
    - [x] StationRepoTest

---

## Step2 기능 목록

- [x] 지하철 노선 추가 API 수정
    - [x] (LineRequest) 필드가 비어있는경우 예외 처리 기능
    - [x] 시작 id와 도착 id가 같으면 예외 처리 기능
    - [x] SectionRepository 에 구간 추가 기능


- [x] LineService 응답 기능 리팩토링
    - [x] 노선 조회 시, 노선 구간에 포함된 역 목록을 담아 반환

- [x] 구간 추가 기능 (Section Service)
    - [x] 잘못된 입력 예외 처리기능
        - [x] URL에 들어온 LineId가 존재하지 않으면 예외 처리 기능
        - [x] downStationId 와 upStationId 둘다 같으면 예외 처리기능
        - [x] downStationId 와 upStationId 둘중 하나라도 존재하지 않는 stationId인 경우 예외 처리기능
        - [x] downStationId 와 upStationId 둘다 노선에 등록되어 있으면 예외 처리 기능
        - [x] downStationId 와 upStationId 둘다 노선에 등록되어 있지 않으면 예외 처리 기능
        - [x] upStationId에 기준으로 뒤에 이어 붙이는 기능
            - [x] upStationId 뒤에 연결된것이 있는지 확인하는기능
                - [x] 그냥 이어 붙이는 기능 (하행선 갱신)
                - [x] 구간 업데이트 기능
                    - [x] 기존에 존재하는 구간이, 삽입되려는 구간보다 같거나 짧은 경우 예외를 발생 시키는 기능
                    - [x] 새로운 구간을 삽입하는 기능
                        - [x] request로 온 구간을 삽입하는 기능
                        - [x] 기존 구간을 삭제하는 기능
                        - [x] 요청으로온 downStationId이 출발지이며, 기존의 downStationId을 목적지로 한 구간을 삽입하는 기능

- [x] downStationId 기준으로 앞에 이어 붙이는 기능
    - [x] downStationId 앞에 연결된것이 있는지 확인하는기능
    - [x] 그냥 이어 붙이는 기능 (상행선 갱신)
    - [x] 구간 업데이트 기능
        - [x] 기존에 존재하는 구간이, 삽입되려는 구간보다 같거나 짧은 경우 예외를 발생 시키는 기능
        - [x] 새로운 구간을 삽입하는 기능
            - [x] request로 온 구간을 삽입하는 기능
            - [x] 기존 구간을 삭제하는 기능
            - [x] 기존의 upStationId이 출발지이며, 요청으로온 upStationId을 목적지로 한 구간을 삽입하는 기능

- [x] 구간 삭제 기능
    - [x] 잘못된 입력 예외 처리 기능
        - [x] URL에 들어온 LineId가 존재하지 않으면 예외 처리 기능
        - [x] line에 속해있는 구간이 2개 이하인경우 예외 처리 기능
        - [x] URL에 들어온 stationId가 Line에 속해있지 않으면 예외 처리 기능
    - [x] 구간 삭제 기능
        - [x] station id를 상행으로 가지고 있는 구간을 검색
            - [x] station id를 하행으로 가지고 있는 구간이 없으면 바로 삭제
            - [x] 중간 구간 삭제, 갱신
                - [x] stationId를 하행으로 가지고 있는 frontStationId <-> stationId 구간 삭제
                - [x] stationId <-> station id를 상행으로 가지고 있는 backStationId 구간 삭제
                - [x] stationId를 하행으로 가지고 있는 frontStationId <-> station id를 상행으로 가지고 있는 backStationId 구간 생성
        - [x] station id를 하행으로 가지고 있는 구간 삭제


- [x] SectionRepository
    - [x] upStation 뒤에 연결된 것이 있는지 확인하는 기능
    - [x] downStation 앞에 연결된 것이 있는지 확인하는 기능
    - [x] upStationId를 출발점으로, 가장 짧은 거리를 지닌 downStationId와 거리를 반환하는 기능

---

## Refactoring TODO

- [x] 중복 이름,id 처리와 동일 구간 삽입에 대한 예외 분리하기
- [x] 전체 id를 얻기위해 상행id, 하행 id를 두번 걸쳐서 db로부터 긁어오던것을 한번에 긁어오도록 수정하기
- [x] 메소드명이 좀 더 명확한 이름을 가지게 수정하기
- [x] 상행선을 찾는 로직에서, 상행성을 찾지 못하는 경우에 대한 처리를 예외를 발생하도록 수정
- [x] 레포지토리가 들고 있는 많은 로직을 도메인으로 이동시키기
- [x] 서비스에 있는 로직을 도메인으로 이동하기
    - [x] 정렬된 stations를 만드는 로직을 도메인으로 분리
    

    